# Cookiecutter Monarch Ingest

A [Copier](https://copier.readthedocs.io/) template for creating Monarch Initiative data ingest projects.

This template creates projects that use:
- [Koza](https://koza.monarchinitiative.org) for data transformations
- [kghub-downloader](https://github.com/monarch-initiative/kghub-downloader) for data downloads
- [uv](https://docs.astral.sh/uv/) for dependency management
- [Just](https://just.systems/) for task automation
- [Ruff](https://github.com/astral-sh/ruff) for Python linting and formatting

## Migration from Cookiecutter + Cruft

This template has been migrated from cookiecutter to copier. **Existing projects using cruft must migrate** to continue receiving template updates.

ðŸ“– **[Read the complete Migration Guide](MIGRATION_GUIDE.md)** for detailed instructions.

**Quick Migration Steps:**
1. Install copier: `pip install copier>=9.4.0`
2. Remove `.cruft.json` from your project
3. Run `copier update --trust` to update using the new copier template
4. Use `copier update` instead of `cruft update` for future updates

**Benefits after migration:**
- âœ¨ No more templated Python files (better IDE support)
- âœ¨ Modern tooling (uv, justfile, updated workflows)
- âœ¨ Multi-transform architecture ready
- âœ¨ AI integration with Dragon AI Agent

## Getting Started

First, install [copier](https://copier.readthedocs.io/en/stable/installing/):

```bash
pip install copier
```

Then, create a new project using this template:

```bash
copier copy https://github.com/monarch-initiative/cookiecutter-monarch-ingest.git my-ingest-project
```

This will start an interactive session to fill in the following project details  
(fields starting with `__` are automatically generated, and require no input):

- `github_org_name`: the GitHub organization or user name
- `project_name`: the name of the project
- `project_description`: a brief description of the project
- `__repo_name`: the name of the repository
   - **NOTE:** This is automatically generated from the project name, and replaces spaces with hyphens.  
   It must be unique within the organization or user account,  
   and should be a valid repository name (no spaces, special characters, etc.)
- `__project_slug`: A lowercased, hyphen-separated version of the project name (e.g., `my-project`).
- `__project_url`: The GitHub URL for this project.  
   - Automatically generated from the `github_org_name` and `__repo_name`.
   When you create your repository, it must match this URL.
- `ingest_source`: The source of the data to be ingested (ex. `alliance`, `flybase`, or `hpoa`).
- `ingest_type`: The type of data to be ingested (ex. `gene`, `disease_to_phenotype`, or `disease_associations`).
- `__ingest_name`: Automatically generated as `{{ingest_source}}_{{ingest_type}}`.
- `full_name`: Name of the project author
- `email`: Email address of the project author
- `__author`: Automatically generated as `{{full_name}} <{{email}}>`
- `license`: The license for the project (default is `BSD-3`)


Once the project is created, you can keep it up to date by occasionally running the following command in the project directory:

```bash
copier update
```

For more information, see the [copier documentation](https://copier.readthedocs.io/en/stable/updating/)

## Setting Up a New Project

Upon creating a new project from the `cookiecutter-monarch-ingest` template, you can install and test the project:

```bash
cd my-ingest-project
just setup
just test
```

There are a few additional steps to complete before the project is ready for use.

#### GitHub Repository

1. Create a new repository on GitHub (the name must match the `__repo_name` generated by the cookiecutter).
1. Enable GitHub Actions to read and write to the repository (required to deploy the project to GitHub Pages).
   - in GitHub, go to Settings -> Action -> General -> Workflow permissions and choose read and write permissions
1. Initialize the local repository and push the code to GitHub. For example:

   ```bash
   cd {{cookiecutter.project_name}}
   git init
   git remote add origin https://github.com/<username>/<repository>.git
   git add -A && git commit -m "Initial commit"
   git push -u origin main
   ```

#### Transform Code and Configuration

1. Edit the `download.yaml`, `transform.py`, `transform.yaml`, and `metadata.yaml` files to suit your needs.
   - For more information, see the [Koza documentation](https://koza.monarchinitiative.org) and [kghub-downloader](https://github.com/monarch-initiative/kghub-downloader).
1. Add any additional dependencies to the `pyproject.toml` file.
1. Adjust the contents of the `tests` directory to test the functionality of your transform.

#### Documentation

1. Update this `README.md` file with any additional information about the project.
1. Add any appropriate documentation to the `docs` directory.

> **Note:** After the GitHub Actions for deploying documentation runs, the documentation will be automatically deployed to GitHub Pages.  
> However, you will need to go to the repository settings and set the GitHub Pages source to the `gh-pages` branch, using the `/docs` directory.

## Project Structure

Cruft/cookiecutter will create a project with the following structure:

```
{{cookiecutter.project_name}}
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ create-release.yaml
â”‚   â”‚   â”œâ”€â”€ deploy-docs.yaml
â”‚   â”‚   â”œâ”€â”€ test.yaml
â”‚   â”‚   â”œâ”€â”€ update-docs.yaml
|   â”œâ”€â”€ dependabot.yaml
â”œâ”€â”€ docs/
â”œâ”€â”€ src/{{cookiecutter.__project_slug}}
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cli.py
â”œâ”€â”€ â”œâ”€â”€ download.yaml
â”‚   â”œâ”€â”€ metadata.yaml
â”‚   â”œâ”€â”€ transform.py
â”‚   â”œâ”€â”€ transform.yaml
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_example.py
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ CONTRIBUTING.md
â”œâ”€â”€ LICENSE
â”œâ”€â”€ Makefile
â”œâ”€â”€ mkdocs.yaml
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ README.md
```

### GitHub Actions

- `test.yaml`: Run the pytest suite.
- `create-release.yaml`: Create a new release once a week, or manually.
- `deploy-docs.yaml`: Deploy the documentation to GitHub Pages (on pushes to main).
- `update-docs.yaml`: After a release, update the documentation with node/edge reports.